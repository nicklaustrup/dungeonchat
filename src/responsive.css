/* responsive.css - Phase 1 foundational breakpoints & mobile-first adjustments */

/* Breakpoint custom properties (can be reused in JS later if needed) */
:root {
  --bp-xs: 360px; /* ultra small devices */
  --bp-sm: 600px; /* base mobile / phablet cutoff */
  --bp-md: 900px; /* desktop threshold for expanded UI */
  --bp-lg: 1200px; /* large desktop */
}

/* Base tap target normalization (opt-in via specific classes to avoid layout explosions) */
/* Tap target normalization: exclude reaction buttons on wide/fine-pointer screens to preserve classic compact bar */
.bar-icon-btn, .menu-reaction-btn, .send-btn {
  min-width: 44px;
  min-height: 44px;
}
/* Only enlarge reaction buttons for touch/mobile contexts */
@media (hover: none) and (pointer: coarse), (max-width: 599px) {
  .reaction-btn { min-width:44px; min-height:44px; }
}

/* Phase 1: Mobile sticky input & safe-area padding */
@media (max-width: 599px) {
  .chat-input-area {
    position: sticky; /* relies on being inside scroll container; harmless fallback otherwise */
    bottom: 0;
    background: var(--bg-secondary);
    padding-bottom: calc(env(safe-area-inset-bottom, 0) + 4px);
    box-shadow: 0 -2px 8px rgba(0,0,0,0.35);
    z-index: 120; /* sit above message list */
  }

  /* Slightly tighter horizontal spacing on very small screens */
  :root { --message-horizontal-gap: 10px; }
}

/* Phase 2: Reduced Motion Accessibility */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition:none !important; }
  .message-menu, .typing-bubble, .emoji-picker-portal { animation:none !important; }
}

/* Phase 2: Focus visibility for keyboard/assistive nav */
:focus-visible { outline:2px solid var(--primary-color); outline-offset:2px; }

/* Phase 2: Mobile shadow scaling (lighter to reduce paint cost) */
@media (max-width:599px) {
  .message-menu { box-shadow: 0 6px 18px rgba(0,0,0,0.4); }
  .emoji-picker-portal { box-shadow: 0 8px 24px rgba(0,0,0,0.45); }
}

/* Ultra-small devices: hide optional text labels inside icon buttons if present */
@media (max-width: 359px) {
  .bar-icon-btn .label { display: none; }
}

/* Coarse pointer (touch) fallback for reaction buttons: always visible without hover */
@media (hover: none) and (pointer: coarse) {
  .reaction-buttons {
    opacity: 1 !important;
    position: static;
    background: transparent;
    padding: 0;
    border: none;
    box-shadow: none;
  }
  .reaction-btn {
    background: var(--bg-light);
    border-radius: 10px;
  }
  .reaction-btn:hover { background: var(--primary-color); }
}

/* Landscape short viewports (virtual keyboard eating vertical space) */
@media (orientation: landscape) and (max-height:480px) {
  :root { --message-horizontal-gap: 6px; }
  .chat-input-area { padding: 4px 6px calc(env(safe-area-inset-bottom,0) + 2px); }
  .reaction-buttons { gap: 4px; }
}

/* Popover/menu horizontal edge shift helper (class added dynamically) */
.message-menu.edge-shift { transform-origin: top center; }
.message-menu.edge-shift.mode-up { transform-origin: bottom center; }

/* Keyboard open heuristic support (html.keyboard-open added by JS) */
html.keyboard-open .chatroom-shell { padding-bottom: 45vh; }
html.keyboard-open .chat-input-area { box-shadow: 0 -2px 4px rgba(0,0,0,0.25); }
