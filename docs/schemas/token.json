{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "Token",
  "description": "VTT token on a map",
  "type": "object",
  "required": ["id", "x", "y", "type", "createdAt"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Token ID"
    },
    "x": {
      "type": "number",
      "description": "X coordinate on map (pixels)"
    },
    "y": {
      "type": "number",
      "description": "Y coordinate on map (pixels)"
    },
    "type": {
      "type": "string",
      "enum": ["pc", "npc", "enemy", "object", "marker"],
      "description": "Token type"
    },
    "characterId": {
      "type": "string",
      "description": "Linked character sheet ID (for PC tokens)"
    },
    "ownerId": {
      "type": "string",
      "description": "User ID of token owner (for PC tokens)"
    },
    "name": {
      "type": "string",
      "description": "Token display name"
    },
    "imageURL": {
      "type": "string",
      "format": "uri",
      "description": "Token image URL"
    },
    "size": {
      "type": "number",
      "default": 1,
      "description": "Token size in grid squares (1 = medium, 2 = large, etc.)"
    },
    "rotation": {
      "type": "number",
      "minimum": 0,
      "maximum": 360,
      "default": 0,
      "description": "Token rotation in degrees"
    },
    "vision": {
      "type": "object",
      "properties": {
        "range": {
          "type": "number",
          "description": "Vision range in feet"
        },
        "darkvision": {
          "type": "number",
          "default": 0,
          "description": "Darkvision range in feet"
        },
        "blindsight": {
          "type": "number",
          "default": 0,
          "description": "Blindsight range in feet"
        }
      }
    },
    "light": {
      "type": "object",
      "properties": {
        "range": {
          "type": "number",
          "description": "Light emission range in feet"
        },
        "color": {
          "type": "string",
          "description": "Light color (hex)"
        },
        "intensity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Light intensity (0-1)"
        }
      }
    },
    "conditions": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["blinded", "charmed", "deafened", "frightened", "grappled", "incapacitated", "invisible", "paralyzed", "petrified", "poisoned", "prone", "restrained", "stunned", "unconscious"]
      },
      "description": "Active conditions on token"
    },
    "hp": {
      "type": "object",
      "properties": {
        "current": { "type": "number" },
        "max": { "type": "number" },
        "temp": { "type": "number", "default": 0 }
      },
      "description": "HP tracking (optional)"
    },
    "ac": {
      "type": "number",
      "description": "Armor class (optional)"
    },
    "initiative": {
      "type": "number",
      "description": "Initiative roll (for combat tracker)"
    },
    "hidden": {
      "type": "boolean",
      "default": false,
      "description": "Hidden from players (DM only)"
    },
    "locked": {
      "type": "boolean",
      "default": false,
      "description": "Movement locked (DM only)"
    },
    "staged": {
      "type": "boolean",
      "default": false,
      "description": "Staged token (not yet placed on map)"
    },
    "createdAt": {
      "type": "object",
      "description": "Firestore server timestamp"
    },
    "updatedAt": {
      "type": "object",
      "description": "Firestore server timestamp"
    }
  },
  "firestorePath": "/campaigns/{campaignId}/vtt/{mapId}/tokens/{tokenId}",
  "securityNotes": [
    "DM can create, update, delete any token",
    "Players can create their own PC tokens (staged)",
    "Players can update their own PC tokens (position, etc.)",
    "All campaign members can read tokens"
  ],
  "indexing": {
    "required": []
  }
}
