"use strict";(self.webpackChunkdungeonchat=self.webpackChunkdungeonchat||[]).push([[942],{"./src/stories/ChatHeader.stories.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,LongUserName:()=>LongUserName,WithSearchValue:()=>WithSearchValue,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ChatHeader_stories});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function SettingsModal_SettingsModal(_ref){let{isOpen,onClose,isDarkTheme,toggleTheme,soundEnabled,toggleSound,awayAfterSeconds,setAwayAfterSeconds}=_ref;const warnedRef=react.useRef(!1),pendingRef=react.useRef(null),[localMinutes,setLocalMinutes]=react.useState(()=>Math.round(awayAfterSeconds/60));react.useEffect(()=>{setLocalMinutes(Math.round(awayAfterSeconds/60))},[awayAfterSeconds]);const commit=react.useCallback(mins=>{"function"==typeof setAwayAfterSeconds?setAwayAfterSeconds(60*mins):warnedRef.current||(console.warn("[SettingsModal] setAwayAfterSeconds missing or not a function. Ignoring update."),warnedRef.current=!0)},[setAwayAfterSeconds]),debouncedCommit=react.useCallback(mins=>{pendingRef.current&&clearTimeout(pendingRef.current),pendingRef.current=setTimeout(()=>{commit(mins)},400)},[commit]);return isOpen?(0,jsx_runtime.jsx)("div",{className:"settings-modal-overlay",onClick:onClose,children:(0,jsx_runtime.jsxs)("div",{className:"settings-modal",onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsx)("h2",{children:"Settings"}),(0,jsx_runtime.jsxs)("div",{className:"settings-item",children:[(0,jsx_runtime.jsx)("span",{children:"Sound"}),(0,jsx_runtime.jsx)("button",{className:"icon-btn",onClick:toggleSound,title:"Toggle sound",children:soundEnabled?"ðŸ”Š":"ðŸ”‡"})]}),(0,jsx_runtime.jsxs)("div",{className:"settings-item",children:[(0,jsx_runtime.jsx)("span",{children:"Theme"}),(0,jsx_runtime.jsx)("button",{className:"icon-btn",onClick:toggleTheme,title:"Toggle theme",children:isDarkTheme?"â˜€ï¸":"ðŸŒ™"})]}),(0,jsx_runtime.jsxs)("div",{className:"settings-item column",children:[(0,jsx_runtime.jsxs)("label",{htmlFor:"away-timeout-range",style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,jsx_runtime.jsx)("span",{children:"Away Timeout"}),(0,jsx_runtime.jsxs)("span",{style:{fontVariantNumeric:"tabular-nums"},children:[localMinutes,"m"]})]}),(0,jsx_runtime.jsx)("input",{id:"away-timeout-range",type:"range",min:1,max:60,value:localMinutes,onChange:e=>{const mins=parseInt(e.target.value,10);isNaN(mins)||(setLocalMinutes(mins),debouncedCommit(mins))},title:"Minutes of inactivity before showing Away"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",marginTop:4},children:[(0,jsx_runtime.jsx)("button",{className:"icon-btn",onClick:()=>{setLocalMinutes(5),commit(5)},title:"Reset to 5 minutes",children:"Reset"}),(0,jsx_runtime.jsx)("small",{style:{opacity:.7},children:"Updates debounced"})]})]}),(0,jsx_runtime.jsx)("button",{className:"settings-close",onClick:onClose,children:"Close"})]})}):null}const components_SettingsModal_SettingsModal=SettingsModal_SettingsModal;SettingsModal_SettingsModal.__docgenInfo={description:"",methods:[],displayName:"SettingsModal"};var FirebaseContext=__webpack_require__("./src/services/FirebaseContext.js");function SignOut(){const{auth,signOut}=(0,FirebaseContext.D3)();return auth.currentUser&&(0,jsx_runtime.jsx)("button",{className:"sign-out",onClick:()=>signOut(auth),children:"Sign Out"})}const SignOut_SignOut=SignOut;SignOut.__docgenInfo={description:"",methods:[],displayName:"SignOut"};const hooks_useMenuToggle=function useMenuToggle(){let{initialOpen=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[open,setOpen]=react.useState(initialOpen),triggerRef=react.useRef(null),menuRef=react.useRef(null),close=react.useCallback(()=>setOpen(!1),[]),toggle=react.useCallback(()=>setOpen(o=>!o),[]);return react.useEffect(()=>{if(!open)return;const onPointer=e=>{const trigger=triggerRef.current,menu=menuRef.current;menu&&(menu.contains(e.target)||null!=trigger&&trigger.contains(e.target)||close())},onKey=e=>{"Escape"===e.key&&close()};return document.addEventListener("pointerdown",onPointer,!0),document.addEventListener("keydown",onKey,!0),()=>{document.removeEventListener("pointerdown",onPointer,!0),document.removeEventListener("keydown",onKey,!0)}},[open,close]),{open,setOpen,toggle,close,triggerRef,menuRef}};const hooks_useTruncationObserver=function useTruncationObserver(){const elementsRef=react.useRef(new Set),compute=react.useCallback(()=>{elementsRef.current.forEach(el=>{if(!el)return;el.scrollWidth>el.clientWidth?el.setAttribute("data-truncated","true"):el.removeAttribute("data-truncated")})},[]),register=react.useCallback(el=>{el&&(elementsRef.current.add(el),compute())},[compute]);return react.useEffect(()=>{if("function"!=typeof ResizeObserver)return window.addEventListener("resize",compute),()=>window.removeEventListener("resize",compute);const ro=new ResizeObserver(()=>compute());return elementsRef.current.forEach(el=>el&&ro.observe(el)),window.addEventListener("resize",compute),()=>{ro.disconnect(),window.removeEventListener("resize",compute)}},[compute]),{register,recompute:compute}};function UserMenu(_ref){let{user,onViewProfile,onOpenSettings,openSettings,children}=_ref;const{open,toggle,close,triggerRef,menuRef}=hooks_useMenuToggle(),{register,recompute}=hooks_useTruncationObserver();if(!user)return null;const display=user.displayName||"Anonymous",avatar=user.photoURL||"/logo192.png";return(0,jsx_runtime.jsxs)("div",{className:"user-menu-info-wrapper",children:[(0,jsx_runtime.jsxs)("div",{className:"user-menu-wrapper",children:[(0,jsx_runtime.jsxs)("button",{ref:triggerRef,className:"user-chip user-menu-trigger ".concat(open?"open":""),"aria-haspopup":"true","aria-expanded":open?"true":"false",title:display,onClick:()=>{toggle(),setTimeout(recompute,0)},children:[(0,jsx_runtime.jsx)("img",{src:avatar,alt:display,className:"user-chip-avatar"}),(0,jsx_runtime.jsx)("span",{ref:register,className:"user-chip-name trunc-tooltip","data-full":display,children:display}),(0,jsx_runtime.jsx)("span",{className:"user-menu-caret",children:"â–¾"})]}),(0,jsx_runtime.jsxs)("div",{ref:menuRef,className:"user-menu ".concat(open?"open":""),onClick:e=>e.stopPropagation(),role:"menu","aria-label":"User menu",children:[(0,jsx_runtime.jsx)("div",{className:"user-menu-section user-menu-profile",children:(0,jsx_runtime.jsxs)("div",{className:"user-menu-avatar-row",children:[(0,jsx_runtime.jsx)("img",{src:avatar,alt:display,className:"user-menu-avatar"}),(0,jsx_runtime.jsxs)("div",{className:"user-menu-names",children:[(0,jsx_runtime.jsx)("span",{ref:register,className:"user-menu-display trunc-tooltip","data-full":display,children:display}),(0,jsx_runtime.jsx)("span",{ref:register,className:"user-menu-email trunc-tooltip","data-full":user.email||"",children:user.email||""})]})]})}),(0,jsx_runtime.jsxs)("div",{className:"user-menu-section user-menu-actions",children:[(0,jsx_runtime.jsx)("button",{className:"user-menu-item actionable",onClick:()=>{onViewProfile&&onViewProfile(user),close()},children:"Edit Profile"}),(0,jsx_runtime.jsx)("button",{className:"user-menu-item actionable",onClick:()=>{openSettings(),onOpenSettings&&onOpenSettings(),close()},children:"Settings"})]}),(0,jsx_runtime.jsx)("div",{className:"user-menu-section user-menu-signout",children:(0,jsx_runtime.jsx)(SignOut_SignOut,{})})]})]}),children]})}function SearchBar(_ref){let{value,onChange}=_ref;return(0,jsx_runtime.jsx)("div",{className:"search-wrapper",children:(0,jsx_runtime.jsx)("div",{className:"search-container always-visible",children:(0,jsx_runtime.jsx)("input",{type:"text",placeholder:"Search","aria-label":"Search messages",value,onChange:e=>onChange(e.target.value),className:"search-input-field"})})})}function ChatHeader(_ref){let{user,isDarkTheme,toggleTheme,soundEnabled,toggleSound,showSearch,setShowSearch,searchTerm,setSearchTerm,onViewProfile,awayAfterSeconds,setAwayAfterSeconds,onOpenSettings}=_ref;const[settingsOpen,setSettingsOpen]=react.useState(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("header",{className:"App-header",children:(0,jsx_runtime.jsxs)("div",{className:"header-top",children:[(0,jsx_runtime.jsx)("h1",{children:"DungeonChat"}),(0,jsx_runtime.jsx)("div",{className:"logo-container"}),(0,jsx_runtime.jsx)("div",{className:"header-controls",children:user&&(0,jsx_runtime.jsx)(UserMenu,{user,onViewProfile,openSettings:()=>setSettingsOpen(!0),onOpenSettings,children:(0,jsx_runtime.jsx)(SearchBar,{value:searchTerm,onChange:setSearchTerm})})})]})}),(0,jsx_runtime.jsx)(components_SettingsModal_SettingsModal,{isOpen:settingsOpen,onClose:()=>setSettingsOpen(!1),isDarkTheme,toggleTheme,soundEnabled,toggleSound,awayAfterSeconds,setAwayAfterSeconds})]})}UserMenu.__docgenInfo={description:"",methods:[],displayName:"UserMenu"},SearchBar.__docgenInfo={description:"",methods:[],displayName:"SearchBar"};const ChatHeader_ChatHeader=ChatHeader;ChatHeader.__docgenInfo={description:"",methods:[],displayName:"ChatHeader"};const ChatHeader_stories={title:"Chat/ChatHeader",component:ChatHeader_ChatHeader,args:{user:{displayName:"Alice Wonderland",email:"alice@example.com",photoURL:""},isDarkTheme:!0,toggleTheme:()=>{},soundEnabled:!0,toggleSound:()=>{},showSearch:!0,setShowSearch:()=>{},searchTerm:"",setSearchTerm:()=>{},onViewProfile:()=>{},awayAfterSeconds:120,setAwayAfterSeconds:()=>{}},parameters:{chromatic:{disableSnapshot:!1}}},Default=args=>(0,jsx_runtime.jsx)(ChatHeader_ChatHeader,(0,objectSpread2.A)({},args)),WithSearchValue=args=>(0,jsx_runtime.jsx)(ChatHeader_ChatHeader,(0,objectSpread2.A)((0,objectSpread2.A)({},args),{},{searchTerm:"dragon"})),LongUserName=args=>(0,jsx_runtime.jsx)(ChatHeader_ChatHeader,(0,objectSpread2.A)((0,objectSpread2.A)({},args),{},{user:{displayName:"Sir Very Extraordinarily Long Display Name That Truncates",email:"long@example.com",photoURL:""}})),__namedExportsOrder=["Default","WithSearchValue","LongUserName"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"args => <ChatHeader {...args} />",...Default.parameters?.docs?.source}}},WithSearchValue.parameters={...WithSearchValue.parameters,docs:{...WithSearchValue.parameters?.docs,source:{originalSource:'args => <ChatHeader {...args} searchTerm="dragon" />',...WithSearchValue.parameters?.docs?.source}}},LongUserName.parameters={...LongUserName.parameters,docs:{...LongUserName.parameters?.docs,source:{originalSource:"args => <ChatHeader {...args} user={{\n  displayName: 'Sir Very Extraordinarily Long Display Name That Truncates',\n  email: 'long@example.com',\n  photoURL: ''\n}} />",...LongUserName.parameters?.docs?.source}}}}}]);